{% extends 'server/pattern/pattern.html' %}
{% load static %}

{% block title %}{{ data.title }}{% endblock %}
{% block content %}
<div class="page-wrapper">
	<div class="page-content">
	 <div class="dash-wrapper bg-dark">
		 <div class="row row-cols-1 row-cols-md-2 row-cols-xl-5 row-cols-xxl-5">
			 <div class="col border-end border-light-2">
				 <div class="card bg-transparent shadow-none mb-0">
					 <div class="card-body text-center">
						<p class="mb-1 text-white">Мои заявки</p>
						<h3 class="mb-3 text-white">{{ data_statistic.application.0 }} </h3>
						 <p class="font-13 text-white">
							 {% if data_statistic.application.2 > 0 %}
							 <span class="text-success"><i class="lni lni-arrow-up"></i>{{ data_statistic.application.2 }}%</span>
							 {% else %}
							 <span class="text-danger"><i class="lni lni-arrow-down"></i>{{ data_statistic.application.2 }}%</span>
							 {% endif %}
							 За последние 7 дней: <span class="text-success">{{ data_statistic.application.1  }}</span></p>
						<div class="progress radius-10 mt-4" style="height:4.5px;">
							<div class="progress-bar bg-success" role="progressbar" style="width: {{ data_statistic.application.0 }} %"></div>
						</div>
					 </div>
				 </div>
			 </div>
			 <div class="col border-end border-light-2">
				<div class="card bg-transparent shadow-none mb-0">
					<div class="card-body text-center">
					   <p class="mb-1 text-white">Согласованные/Отклоненные заявки</p>
					   <h3 class="mb-3 text-white">{{ data_statistic.approved.0 }}/{{ data_statistic.approved.1 }}</h3>
					   <p class="font-13 text-white"><span class="text-success"><i class="lni lni-arrow-up"></i> {{ data_statistic.approved.2 }}% </span> процент согласованных от отклоненных</p>
					   <div class="progress radius-10 mt-4" style="height:4.5px;">
							<div class="progress-bar bg-primary" role="progressbar" style="width: {{ data_statistic.approved.2 }}%"></div>
					   </div>
					</div>
				</div>
			</div>
			<div class="col border-end border-light-2">
				<div class="card bg-transparent shadow-none mb-0">
					<div class="card-body text-center">
					   <p class="mb-1 text-white">Мой план</p>
					   <h3 class="mb-3 text-white">{{ data_statistic.plan.0 }} / {{ data_statistic.plan.1 }}</h3>
					   <p class="font-13 text-white"><span class="text-success"><i class="lni lni-arrow-up"></i> {{ data_statistic.plan.3 }}%</span> Выполненных заявок</p>
					   <div class="progress radius-10 mt-4" style="height:4.5px;">
							<div class="progress-bar bg-danger" role="progressbar" style="width: {{ data_statistic.plan.3 }}%"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="col border-end border-light-2">
				<div class="card bg-transparent shadow-none mb-0">
					<div class="card-body text-center">
					   <p class="mb-1 text-white">Мои звонки</p>
					   <h3 class="mb-3 text-white">{{ data_statistic.calls.0 }}</h3>
					   <p class="font-13 text-white"><span class="text-success">{{ data_statistic.calls.2 }}</span> Среднее количество звонков на одну заявку</p>
					   <div class="progress radius-10 mt-4" style="height:4.5px;">
							<div class="progress-bar bg-success" role="progressbar" style="width: {{ data_statistic.calls.1 }}%"></div>
						</div>
					</div>
				</div>
			</div>
			 <div class="col border-end border-light-2">
				<div class="card bg-transparent shadow-none mb-0">
					<div class="card-body text-center">
					   <p class="mb-1 text-white">Всего продано тонн</p>
					   <h3 class="mb-3 text-white">{{ data_statistic.tons.0 }}</h3>
					   <p class="font-13 text-white">
						   {% if data_statistic.tons.1 > 0 %}
							 <span class="text-success"><i class="lni lni-arrow-up"></i>{{ data_statistic.tons.1 }}%</span>
							 {% else %}
							 <span class="text-danger"><i class="lni lni-arrow-down"></i>{{ data_statistic.tons.1 }}%</span>
							 {% endif %}
						   За последние 30 дней {{ data_statistic.tons.2 }} тонн</p>
					   <div class="progress radius-10 mt-4" style="height:4.5px;">
							<div class="progress-bar bg-info" role="progressbar" style="width: {{ data_statistic.tons.1 }}%"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="col col-md-12">
				<div class="card bg-transparent shadow-none mb-0">
					<div class="card-body text-center">
					   <p class="mb-1 text-white">Наилучший регион</p>
					   <h3 class="mb-3 text-white">{{ data_statistic.top_region.0 }}</h3>
					   <p class="font-13 text-white"><span class="text-success"><i class="lni lni-arrow-up"></i> {{ data_statistic.top_region.2 }}%</span> Общая доля заявок: {{ data_statistic.top_region.1 }}</p>
					</div>
				</div>
			</div>
		 </div><!--end row-->
	 </div>

	  <div class="row row-cols-1 row-cols-xl-2">
		<div class="col d-flex">
			<div class="card radius-10 w-100">
				<div class="card-body">
					<div class="d-flex align-items-center">
						<div>
							<h6 class="mb-0">Sales Overview</h6>
						</div>
						  <div class="dropdown ms-auto">
								<button class="btn btn-white btn-sm radius-10 dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
									This Month
								</button>
								<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
									<li><a class="dropdown-item" href="#">This Week</a></li>
									<li><a class="dropdown-item" href="#">This Month</a></li>
									<li><a class="dropdown-item" href="#">This Year</a></li>
								</ul>
							</div>
					</div>
				  <div id="chart6"></div>
				</div>
			</div>
		</div>
		<div class="col d-flex">
			<div class="card radius-10 w-100">
				<div class="card-body">
					<div class="d-flex align-items-center">
						<div>
							<h6 class="mb-0">Visitor Status</h6>
						</div>Уже
						<div class="d-flex align-items-center ms-auto font-13 gap-2">
							<span class="border px-1 rounded cursor-pointer"><i class='bx bxs-circle text-primary me-1'></i>New Visitor</span>
							<span class="border px-1 rounded cursor-pointer"><i class='bx bxs-circle text-sky-light me-1'></i>Old Visitor</span>
						</div>
					</div>
				  <div id="chart7"></div>
				</div>
			</div>
		</div>
	  </div><!--end row-->
		<div class="card-body">
			<ul class="nav nav-tabs nav-primary mb-0" role="tablist">
				<li class="nav-item" role="presentation">
					<a class="nav-link active" data-bs-toggle="tab" href="#primaryhome" role="tab" aria-selected="true">
						<div class="d-flex align-items-center">
							<div class="tab-icon"><i class='bx bx-comment-detail font-18 me-1'></i>
							</div>
							<div class="tab-title"> Мой план</div>
						</div>
					</a>
				</li>
				<li class="nav-item" role="presentation">
					<a class="nav-link" data-bs-toggle="tab" href="#primaryprofile" role="tab" aria-selected="false">
						<div class="d-flex align-items-center">
							<div class="tab-icon"><i class='bx bx-bookmark-alt font-18 me-1'></i>
							</div>
							<div class="tab-title">Мои заявки</div>
						</div>
					</a>
				</li>
			</ul>
			<div class="tab-content pt-3">
				<div class="tab-pane fade show active" id="primaryhome" role="tabpanel">
					<h6 class="mb-0 text-uppercase">Фермера</h6>
				<hr/>
					<div class="card">
						<div class="card-body">
							<div class="table-responsive">
								<table id="example" class="table table-striped table-bordered" style="width:100%">
									<thead>
										<tr>
											<th>Фермер</th>
											<th>Регион</th>
											<th>Телефон</th>
											<th>Почта</th>
											<th>Адрес</th>
										</tr>
									</thead>
									<tbody>
										{% for farmer in planned_farmers %}
										<tr>
											<td><a href="{% url 'application' farmer.farmer.id %}">{{ farmer.farmer }}</a></td>
											<td>{{ farmer.region }}</td>
											<td>{{ farmer.phone|default:"—" }}</td>
											<td>{{ farmer.mail|default:"—" }}</td>
											<td>{{ farmer.address }} ({% if farmer.farmer.region %}{{ farmer.farmer.region.name }}{% endif %})</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
				<div class="tab-pane fade" id="primaryprofile" role="tabpanel">
					<h6 class="mb-0 text-uppercase">Заявки</h6>
				<hr/>
					<div class="card">
						<div class="card-body">
							<div class="table-responsive">
								<table id="example2" class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Фермер</th>
											<th>Описание продукта</th>
											<th>Цена СХТП (НДС/Без НДС)</th>
											<th>Срок поставки</th>
											<th>Менеджер</th>
											<th>Статус</th>
										</tr>
									</thead>
									<tbody>
										{% for app in applications %}
											<tr>
												<td>
													{% if app.farmer %}
													<a href="{% url 'application' app.farmer.id %}"> {{ app.farmer.farmer }} {% if app.farmer.region %} ({{ app.farmer.region.name }}) {% endif %}</a>
													{% else %}
														Отсутствует
													{% endif %}
												</td>
												<td>
													{% if app.product %}
														{{ app.product }}
													{% else %}
														Отсутствует
													{% endif %}
													;
													{% if app.product_quality %}
														{{ app.product_quality }}
													{% else %}
														Отсутствует
													{% endif %}
												</td>
												<td>
													{{ app.price }}
												</td>
												<td>
													{% if app.date_delivery %}
														{{ app.date_delivery }}
													{% else %}
														Отсутствует
													{% endif %}
												</td>
												<td>
													{{ app.manager_name }}
												</td>
												<td>
													{% if app.status %}
														{{ app.status }}
													{% else %}
														Отсутствует
													{% endif %}
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

{% endblock %}